<div class="dashboard-container" [class.embedded]="embedded">
	@if (!embedded) {
		<app-sidebar
			[menuItems]="sidebarItems"
			[currentUser]="currentUser"
			[cartCount]="cartCount">
		</app-sidebar>
	}

	<div class="dashboard-content" [class.embedded]="embedded">
		@if (!embedded) {
			<div class="dashboard-tabs">
				@for (tab of tabs; track tab.id) {
					<button
						class="tab-button"
						[class.active]="activeTab === tab.id"
						(click)="setActiveTab(tab.id)">
						<span class="tab-icon">{{ tab.icon }}</span>
						<span>{{ tab.label }}</span>
					</button>
				}
			</div>
		}

		@if (activeTab === 'resumen') {
			<!-- Primary summary stats (first row: 4 cards) -->
			<div class="dashboard-stats">
				@for (stat of primaryStats; track stat.title) {
					<app-stat-card
						[title]="stat.title"
						[value]="stat.value"
						[subtitle]="stat.subtitle ?? ''"
						[trendLabel]="stat.trendLabel ?? ''"
						[trendDirection]="stat.trendDirection ?? ''"
						[iconSvg]="stat.iconSvg"
						[variant]="stat.variant">
					</app-stat-card>
				}
			</div>

			<!-- Secondary summary stats (second row: 3 prominent cards) -->
			<div class="dashboard-stats dashboard-stats-secondary">
				@for (stat of secondaryStats; track stat.title) {
					<app-stat-card
						[title]="stat.title"
						[value]="stat.value"
						[subtitle]="stat.subtitle ?? ''"
						[trendLabel]="stat.trendLabel ?? ''"
						[trendDirection]="stat.trendDirection ?? ''"
						[iconSvg]="stat.iconSvg"
						[variant]="stat.variant">
					</app-stat-card>
				}
			</div>

		<div class="dashboard-grid">
			<div class="chart-section">
				<div class="section-header">
					<h2>Ingresos</h2>
					<select class="time-filter-select">
						<option>Esta Semana</option>
						<option>Mes Actual</option>
						<option>Último Mes</option>
					</select>
				</div>
				<div class="chart-container" (mouseleave)="onChartLeave()">
					<svg viewBox="0 0 1100 350" preserveAspectRatio="xMidYMid meet" class="chart-svg" (mousemove)="onChartMove($event)">
						<!-- Grid lines verticales -->
						<line x1="100" y1="50" x2="100" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="252" y1="50" x2="252" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="405" y1="50" x2="405" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="558" y1="50" x2="558" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="711" y1="50" x2="711" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="864" y1="50" x2="864" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="1017" y1="50" x2="1017" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>

						<!-- Grid lines horizontales -->
						<line x1="40" y1="300" x2="1060" y2="300" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>
						<line x1="40" y1="237" x2="1060" y2="237" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="40" y1="175" x2="1060" y2="175" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="40" y1="112" x2="1060" y2="112" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						<line x1="40" y1="50" x2="1060" y2="50" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>

						<!-- Y-axis labels -->
						<text x="30" y="305" font-size="11" fill="#6b7280" text-anchor="end">$0</text>
						<text x="30" y="242" font-size="11" fill="#6b7280" text-anchor="end">$15k</text>
						<text x="30" y="180" font-size="11" fill="#6b7280" text-anchor="end">$30k</text>
						<text x="30" y="117" font-size="11" fill="#6b7280" text-anchor="end">$45k</text>
						<text x="30" y="55" font-size="11" fill="#6b7280" text-anchor="end">$60k</text>

						<!-- Gradient definitions -->
						<defs>
							<linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color:#dc2626;stop-opacity:0.4" />
								<stop offset="50%" style="stop-color:#dc2626;stop-opacity:0.2" />
								<stop offset="100%" style="stop-color:#dc2626;stop-opacity:0" />
							</linearGradient>
							<linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
								<stop offset="0%" style="stop-color:#dc2626" />
								<stop offset="100%" style="stop-color:#ef4444" />
							</linearGradient>
						</defs>

						<!-- Area bajo la curva -->
						<path
							d="M 100 283
							   C 140 283, 212 283, 252 283
							   C 292 283, 365 283, 405 283
							   C 445 243, 518 172, 558 153
							   C 598 135, 671 112, 711 105
							   C 751 98, 824 135, 864 163
							   C 904 191, 977 225, 1017 243
							   L 1017 300
							   L 100 300 Z"
							fill="url(#areaGradient)"
							class="chart-area"/>

						<!-- Línea principal con curvas suaves -->
						<path
							d="M 100 283
							   C 140 283, 212 283, 252 283
							   C 292 283, 365 283, 405 283
							   C 445 243, 518 172, 558 153
							   C 598 135, 671 112, 711 105
							   C 751 98, 824 135, 864 163
							   C 904 191, 977 225, 1017 243"
							stroke="url(#lineGradient)"
							stroke-width="3"
							fill="none"
							class="chart-line"/>

						<!-- Línea vertical del tooltip (cuando esté visible) -->
						@if (tooltipVisible) {
							<line
								[attr.x1]="tooltipX"
								y1="50"
								[attr.x2]="tooltipX"
								y2="300"
								stroke="rgba(255,255,255,0.2)"
								stroke-width="1.5"
								class="tooltip-line"/>
						}

						<!-- Puntos interactivos invisibles para hover -->
						<circle cx="100" cy="295" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Lun', 1000)"/>
						<circle cx="252" cy="291" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Mar', 1500)"/>
						<circle cx="405" cy="266" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Mié', 5000)"/>
						<circle cx="558" cy="153" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Jue', 32000)"/>
						<circle cx="711" cy="105" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Vie', 45000)"/>
						<circle cx="864" cy="83" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Sáb', 50000)"/>
						<circle cx="1017" cy="133" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, 'Dom', 35000)"/>

						<!-- Punto visible cuando hay hover -->
						@if (tooltipVisible) {
							<circle
								[attr.cx]="tooltipX"
								[attr.cy]="getPointY(tooltipDay)"
								r="5"
								fill="#dc2626"
								stroke="#fff"
								stroke-width="2.5"
								class="active-point"/>
						}

						<!-- X-axis labels -->
						<text x="100" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Lun</text>
						<text x="252" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Mar</text>
						<text x="405" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Mié</text>
						<text x="558" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Jue</text>
						<text x="711" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Vie</text>
						<text x="864" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Sáb</text>
						<text x="1017" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">Dom</text>
					</svg>

					@if (tooltipVisible) {
						<div class="chart-tooltip" [style.left.px]="tooltipX" [style.top.px]="tooltipY">
							<div class="tooltip-day">{{ tooltipDay }}</div>
							<div class="tooltip-value-label">Ingresos: <span class="tooltip-value">{{ tooltipValue }}</span></div>
						</div>
					}
				</div>
			</div>

			<div class="top-products-section">
				<div class="section-header">
					<h2>Más Vendidos Hoy</h2>
				</div>
				<div class="products-list">
					@for (product of topProducts; track product.id) {
						<div class="product-row" [class]="'rank-' + product.rank">
							<div class="product-rank">{{ product.rank }}</div>
							<div class="product-name">{{ product.name }}</div>
							<div class="product-bar">
								<div class="bar-fill" [style.width.%]="(product.quantity / topProducts[0].quantity) * 100"></div>
							</div>
							<div class="product-quantity">{{ product.quantity }}</div>
						</div>
					}
				</div>
			</div>
		</div>
		}

		@if (activeTab === 'movimientos') {
			<div class="tab-content">
				<p class="coming-soon">Contenido de Movimientos próximamente...</p>
			</div>
		}

		@if (activeTab === 'usuarios') {
			<div class="tab-content">
				<p class="coming-soon">Contenido de Usuarios próximamente...</p>
			</div>
		}

		@if (activeTab === 'resumen') {
		<div class="recent-orders-section">
			<div class="section-header">
				<h2>Órdenes Recientes</h2>
			</div>
			<div class="orders-table">
				@for (order of recentOrders; track order.id) {
					<div class="order-row" [class]="'status-' + order.status">
						<div class="order-table-num">
							<span>{{ order.tableNumber }}</span>
						</div>
						<div class="order-info">
							<div class="order-items">{{ order.itemsCount }} items</div>
							<div class="order-customer">{{ order.customerName }}</div>
						</div>
						<div class="order-total">{{ order.total | currency }}</div>
						<div class="order-status" [class]="'badge-' + order.status">
							{{ order.statusLabel }}
						</div>
					</div>
				}
			</div>
		</div>
		}
	</div>
</div>
