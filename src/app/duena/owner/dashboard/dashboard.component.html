<div class="dashboard-container" [class.embedded]="embedded">
	@if (!embedded) {
		<app-sidebar
			[menuItems]="sidebarItems"
			[currentUser]="currentUser"
			[cartCount]="cartCount">
		</app-sidebar>
	}

	<div class="dashboard-content" [class.embedded]="embedded">
		@if (!embedded) {
			<div class="dashboard-tabs">
				@for (tab of tabs; track tab.id) {
					<button
						class="tab-button"
						[class.active]="activeTab === tab.id"
						(click)="setActiveTab(tab.id)">
						<span class="tab-icon">{{ tab.icon }}</span>
						<span>{{ tab.label }}</span>
					</button>
				}
			</div>
		}

		@if (activeTab === 'resumen') {
			<!-- Primary summary stats (first row: 4 cards) -->
			<div class="dashboard-stats">
				@for (stat of primaryStats; track stat.title) {
					<app-stat-card
						[title]="stat.title"
						[value]="stat.value"
						[subtitle]="stat.subtitle ?? ''"
						[trendLabel]="stat.trendLabel ?? ''"
						[trendDirection]="stat.trendDirection ?? ''"
						[iconSvg]="stat.iconSvg"
						[variant]="stat.variant">
					</app-stat-card>
				}
			</div>

			<!-- Secondary summary stats (second row: 3 prominent cards) -->
			<div class="dashboard-stats dashboard-stats-secondary">
				@for (stat of secondaryStats; track stat.title) {
					<app-stat-card
						[title]="stat.title"
						[value]="stat.value"
						[subtitle]="stat.subtitle ?? ''"
						[trendLabel]="stat.trendLabel ?? ''"
						[trendDirection]="stat.trendDirection ?? ''"
						[iconSvg]="stat.iconSvg"
						[variant]="stat.variant">
					</app-stat-card>
				}
			</div>

		<div class="dashboard-grid">
			<div class="chart-section">
				<div class="section-header">
					<h2>Ingresos</h2>
					<select class="time-filter-select">
						<option>Esta Semana</option>
						<option>Mes Actual</option>
						<option>Último Mes</option>
					</select>
				</div>
				<div class="chart-container" (mouseleave)="onChartLeave()">
					<svg viewBox="0 0 1100 350" preserveAspectRatio="xMidYMid meet" class="chart-svg" (mousemove)="onChartMove($event)">
						<!-- Grid lines verticales -->
						@for (point of chartPoints; track point.day) {
							<line [attr.x1]="point.x" y1="50" [attr.x2]="point.x" y2="300" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4,4"/>
						}

						<!-- Grid lines horizontales -->
						@for (tick of yTicks; track tick.value) {
							<line x1="40" [attr.y1]="tick.y" x2="1060" [attr.y2]="tick.y" stroke="rgba(255,255,255,0.05)" stroke-width="1" [attr.stroke-width]="tick.value === 0 ? 1.2 : 1" [attr.stroke-dasharray]="tick.value === 0 ? undefined : '4,4'"/>
						}

						<!-- Y-axis labels -->
						@for (tick of yTicks; track tick.value) {
							<text x="30" [attr.y]="tick.y + 5" font-size="11" fill="#6b7280" text-anchor="end">{{ '$' + (tick.value | number:'1.0-0') }}</text>
						}

						<!-- Gradient definitions -->
						<defs>
							<linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color:#dc2626;stop-opacity:0.4" />
								<stop offset="50%" style="stop-color:#dc2626;stop-opacity:0.2" />
								<stop offset="100%" style="stop-color:#dc2626;stop-opacity:0" />
							</linearGradient>
							<linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
								<stop offset="0%" style="stop-color:#dc2626" />
								<stop offset="100%" style="stop-color:#ef4444" />
							</linearGradient>
						</defs>

						<!-- Area bajo la curva -->
						<path
							[attr.d]="areaPath"
							fill="url(#areaGradient)"
							class="chart-area"/>

						<!-- Línea principal -->
						<path
							[attr.d]="linePath"
							stroke="url(#lineGradient)"
							stroke-width="3"
							fill="none"
							class="chart-line"/>

						<!-- Línea vertical del tooltip (cuando esté visible) -->
						@if (tooltipVisible) {
							<line
								[attr.x1]="tooltipSvgX"
								y1="50"
								[attr.x2]="tooltipSvgX"
								y2="300"
								stroke="rgba(255,255,255,0.2)"
								stroke-width="1.5"
								class="tooltip-line"/>
						}

						<!-- Puntos interactivos invisibles para hover -->
						@for (point of chartPoints; track point.day) {
							<circle [attr.cx]="point.x" [attr.cy]="point.y" r="25" fill="transparent" class="chart-point-hover" (mouseenter)="onChartHover($event, point.label, point.value)"/>
						}

						<!-- Punto visible cuando hay hover -->
						@if (tooltipVisible) {
							<circle
								[attr.cx]="tooltipSvgX"
								[attr.cy]="tooltipPointY"
								r="5"
								fill="#dc2626"
								stroke="#fff"
								stroke-width="2.5"
								class="active-point"/>
						}

						<!-- X-axis labels -->
						@for (point of chartPoints; track point.day) {
							<text [attr.x]="point.x" y="325" font-size="12" fill="#9ca3af" text-anchor="middle">{{ point.day }}</text>
						}
					</svg>

					@if (tooltipVisible) {
						<div class="chart-tooltip" [style.left.px]="tooltipX" [style.top.px]="tooltipY">
							<div class="tooltip-day">{{ tooltipDay }}</div>
							<div class="tooltip-value-label">Ingresos: <span class="tooltip-value">{{ tooltipValue }}</span></div>
						</div>
					}
				</div>
			</div>

			<div class="top-products-section">
				<div class="section-header">
					<h2>Más Vendidos Hoy</h2>
				</div>
				<div class="products-list">
					@for (product of topProducts; track product.id) {
						<div class="product-row" [class]="'rank-' + product.rank">
							<div class="product-rank">{{ product.rank }}</div>
							<div class="product-name">{{ product.name }}</div>
							<div class="product-bar">
								<div class="bar-fill" [style.width.%]="(product.quantity / topProducts[0].quantity) * 100"></div>
							</div>
							<div class="product-quantity">{{ product.quantity }}</div>
						</div>
					}
				</div>
			</div>
		</div>
		}

		@if (activeTab === 'movimientos') {
			<div class="tab-content">
				<p class="coming-soon">Contenido de Movimientos próximamente...</p>
			</div>
		}

		@if (activeTab === 'usuarios') {
			<div class="tab-content">
				<p class="coming-soon">Contenido de Usuarios próximamente...</p>
			</div>
		}

		@if (activeTab === 'resumen') {
		<div class="recent-orders-section">
			<div class="section-header">
				<h2>Órdenes Recientes</h2>
			</div>
			<div class="orders-table">
				@for (order of recentOrders; track order.id) {
					<div class="order-row" [class]="'status-' + order.status">
						<div class="order-table-num">
							<span>{{ order.tableNumber }}</span>
						</div>
						<div class="order-info">
							<div class="order-items">{{ order.itemsCount }} items</div>
							<div class="order-customer">{{ order.customerName }}</div>
						</div>
						<div class="order-total">{{ order.total | currency }}</div>
						<div class="order-status" [class]="'badge-' + order.status">
							{{ order.statusLabel }}
						</div>
					</div>
				}
			</div>
		</div>
		}
	</div>
</div>
