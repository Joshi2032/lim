<div class="income-container" [class.embedded]="embedded">
  @if (!embedded) {
    <app-sidebar
      [menuItems]="sidebarItems"
      [currentUser]="currentUser"
      [cartCount]="cartCount">
    </app-sidebar>
  }

  <div class="income-content">
    <app-page-header
      title="Reportes de Ingresos"
      japaneseName="収入報告"
      subtitle="Análisis detallado de ingresos por período">
    </app-page-header>

    <!-- Filters Section -->
    <app-income-filters
      [periodType]="periodType"
      [orderType]="orderType"
      [startDate]="startDate"
      [endDate]="endDate"
      [searchQuery]="searchQuery"
      (periodTypeChange)="periodType = $event; onPeriodTypeChange()"
      (orderTypeChange)="orderType = $event; onOrderTypeChange()"
      (dateChange)="onDateChange()"
      (search)="onSearch()"
      (export)="exportToCSV()">
    </app-income-filters>

    <!-- Stats Cards -->
    <div class="stats-grid">
      @for (card of statCards; track card.title) {
        <app-stat-card
          [title]="card.title"
          [value]="card.value"
          [iconSvg]="card.iconSvg"
          [variant]="card.variant">
        </app-stat-card>
      }
    </div>

    <!-- Period Summary Chart -->
    <app-bar-chart
      [data]="chartData"
      [title]="'Ingresos por ' + (periodType === 'day' ? 'Día' : periodType === 'month' ? 'Mes' : 'Año')"
      emptyMessage="Ajusta los filtros para ver resultados">
    </app-bar-chart>

    <!-- Detailed Table -->
    <app-income-table [records]="filteredRecords"></app-income-table>
  </div>
</div>
