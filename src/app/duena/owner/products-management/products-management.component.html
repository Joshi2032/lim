<div class="products-management">
  <div class="management-header">
    <h2>Gesti√≥n de Productos</h2>
    <button class="btn-add" (click)="toggleForm()">
      + Nuevo Producto
    </button>
  </div>

  <div class="type-tabs">
    <button
      class="type-tab"
      [class.active]="activeType === 'platos'"
      (click)="switchType('platos')">
      üçú Platos
    </button>
    <button
      class="type-tab"
      [class.active]="activeType === 'combos'"
      (click)="switchType('combos')">
      üì¶ Combos
    </button>
  </div>

  <div class="products-list">
    @if (activeType === 'platos') {
      @if (menuItems.length > 0) {
        @for (item of menuItems; track item.id) {
          <div class="product-card">
            <div class="product-header">
              <div class="product-info">
                <h3>{{ item.name }}</h3>
                @if (item.japaneseName) {
                  <p class="japanese">{{ item.japaneseName }}</p>
                }
              </div>
              <div class="product-price">${{ item.price }}</div>
            </div>
            <p class="product-description">{{ item.description }}</p>
            <div class="product-category">
              <span class="badge">{{ item.category }}</span>
            </div>
            <button class="btn-delete" (click)="deleteItem(item.id)">Eliminar</button>
          </div>
        }
      } @else {
        <div class="empty-state">
          <p>No hay platos registrados</p>
        </div>
      }
    }

    @if (activeType === 'combos') {
      @if (combos.length > 0) {
        @for (combo of combos; track combo.id) {
          <div class="product-card">
            <div class="product-header">
              <div class="product-info">
                <h3>{{ combo.name }}</h3>
                @if (combo.japaneseName) {
                  <p class="japanese">{{ combo.japaneseName }}</p>
                }
              </div>
              <div class="product-price">${{ combo.price }}</div>
            </div>
            <p class="product-description">{{ combo.description }}</p>
            <div class="product-category">
              <span class="badge">{{ combo.category }}</span>
            </div>
            <button class="btn-delete" (click)="deleteCombo(combo.id)">Eliminar</button>
          </div>
        }
      } @else {
        <div class="empty-state">
          <p>No hay combos registrados</p>
        </div>
      }
    }
  </div>
</div>

<!-- Product Form Modal -->
<div class="modal-overlay" *ngIf="showForm" (click)="toggleForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ activeType === 'platos' ? 'Nuevo Plato' : 'Nuevo Combo' }}</h2>
      <button type="button" class="close-btn" (click)="toggleForm()" aria-label="Cerrar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      @if (activeType === 'platos') {
        <div class="form">
          <div class="form-group">
            <label class="form-label">Nombre del plato *</label>
            <input
              type="text"
              [(ngModel)]="newItem.name"
              (ngModelChange)="onItemNameChange()"
              placeholder="Ej: Sushi Roll California"
              class="form-input"
              maxlength="50">
            <span class="input-counter">{{ newItem.name.length }}/50</span>
            @if (newItem.japaneseName) {
              <span class="japanese-preview">{{ newItem.japaneseName }}</span>
            }
          </div>

          <div class="form-group">
            <label class="form-label">Foto del plato</label>
            <div class="image-upload-wrapper">
              @if (itemImagePreview) {
                <div class="image-preview">
                  <img [src]="itemImagePreview" alt="Preview">
                  <button type="button" class="change-btn" (click)="itemFileInput.click()">Cambiar</button>
                </div>
              } @else {
                <label class="upload-area" (click)="itemFileInput.click()">
                  <div class="upload-icon">üì∏</div>
                  <div class="upload-text">Selecciona una foto</div>
                </label>
              }
              <input
                #itemFileInput
                type="file"
                accept="image/*"
                (change)="onItemImageSelected($event)"
                class="hidden-input">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Descripci√≥n *</label>
            <textarea
              [(ngModel)]="newItem.description"
              placeholder="Describe los ingredientes y caracter√≠sticas del plato"
              class="form-input form-textarea"
              rows="3"
              maxlength="200"></textarea>
            <span class="input-counter">{{ newItem.description.length }}/200</span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Categor√≠a *</label>
              <select [(ngModel)]="newItem.category" class="form-input">
                <option value="bebidas">ü•§ Bebidas</option>
                <option value="rolls">üçú Rolls</option>
                <option value="nigiri">üç£ Nigiri</option>
                <option value="sashimi">üç± Sashimi</option>
                <option value="especiales">‚≠ê Especiales</option>
                <option value="postres">üç∞ Postres</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Precio *</label>
              <div class="price-input-wrapper">
                <span class="currency">$</span>
                <input
                  type="number"
                  [(ngModel)]="newItem.price"
                  placeholder="0.00"
                  class="form-input price-input"
                  min="0"
                  step="0.01">
              </div>
            </div>
          </div>

          <button class="btn-submit" (click)="addItem()">
            <span>‚úì</span> Guardar Plato
          </button>
        </div>
      }

      @if (activeType === 'combos') {
        <div class="form">
          <div class="form-group">
            <label class="form-label">Nombre del combo *</label>
            <input
              type="text"
              [(ngModel)]="newCombo.name"
              (change)="onComboNameChange()"
              placeholder="Ej: Combo Familiar"
              class="form-input"
              maxlength="50">
            <span class="input-counter">{{ newCombo.name.length }}/50</span>
            @if (newCombo.japaneseName) {
              <span class="japanese-preview">{{ newCombo.japaneseName }}</span>
            }
          </div>
          <div class="form-group">
            <label class="form-label">Foto del combo</label>
            <div class="image-upload-wrapper">
              @if (comboImagePreview) {
                <div class="image-preview">
                  <img [src]="comboImagePreview" alt="Preview">
                  <button type="button" class="change-btn" (click)="comboFileInput.click()">Cambiar</button>
                </div>
              } @else {
                <label class="upload-area" (click)="comboFileInput.click()">
                  <div class="upload-icon">üì∏</div>
                  <div class="upload-text">Selecciona una foto</div>
                </label>
              }
              <input
                #comboFileInput
                type="file"
                accept="image/*"
                (change)="onComboImageSelected($event)"
                class="hidden-input">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Descripci√≥n *</label>
            <textarea
              [(ngModel)]="newCombo.description"
              placeholder="Describe qu√© incluye el combo"
              class="form-input form-textarea"
              rows="3"
              maxlength="200"></textarea>
            <span class="input-counter">{{ newCombo.description.length }}/200</span>
          </div>

          <div class="form-group">
            <label class="form-label">Precio *</label>
            <div class="price-input-wrapper">
              <span class="currency">$</span>
              <input
                type="number"
                [(ngModel)]="newCombo.price"
                placeholder="0.00"
                class="form-input price-input"
                min="0"
                step="0.01">
            </div>
          </div>

          <button class="btn-submit" (click)="addItem()">
            <span>‚úì</span> Guardar Combo
          </button>
        </div>
      }
    </div>
  </div>
</div>
