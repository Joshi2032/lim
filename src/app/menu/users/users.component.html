<div class="users-container">
	<app-sidebar
		[menuItems]="sidebarItems"
		[currentUser]="currentUser"
		[cartCount]="cartCount">
	</app-sidebar>

	<div class="users-content">
		<div class="users-header">
			<div class="header-title">
				<h1>Usuarios <span class="japanese-text">ユーザー</span></h1>
				<p class="header-subtitle">Gestión de empleados y sus roles</p>
			</div>
			<button class="new-user-btn" type="button" (click)="openNewUserModal()">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
				Nuevo Usuario
			</button>
		</div>

		<div class="roles-stats">
			@for (role of roleStats; track role.id) {
				<div class="role-card" [class]="'role-' + role.id">
					<div class="role-icon" [innerHTML]="role.icon"></div>
					<div class="role-value">{{ role.count }}</div>
					<div class="role-label">{{ role.label }}</div>
				</div>
			}
		</div>

		<div class="users-grid">
			@if (users.length > 0) {
				@for (user of users; track user.id) {
					<app-user-card
						[name]="user.name"
						[email]="user.email"
						[roleLabel]="getRoleLabel(user.roleId)"
						[roleId]="user.roleId"
						[initials]="user.initials"
						[status]="user.status"
						(edit)="editUser(user)"
						(delete)="deleteUser(user.id)">
					</app-user-card>
				}
			} @else {
				<div class="empty-state">
					<svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
					<h3>No hay usuarios</h3>
					<p>Agrega el primer usuario del sistema</p>
				</div>
			}
		</div>
	</div>
</div>

<!-- Modal para crear nuevo usuario -->
@if (showNewUserModal) {
	<div class="modal-overlay" (click)="closeNewUserModal()">
		<div class="modal-content" (click)="$event.stopPropagation()">
			<div class="modal-header">
				<h2>Crear Nuevo Usuario</h2>
				<button class="close-btn" (click)="closeNewUserModal()">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</button>
			</div>

			<form [formGroup]="newUserForm" (ngSubmit)="createUser()">
				<div class="form-group">
					<label>Nombre Completo</label>
					<input
						type="text"
						formControlName="name"
						placeholder="Nombre del empleado"
						class="form-input">
				</div>

				<div class="form-group">
					<label>Email</label>
					<input
						type="email"
						formControlName="email"
						placeholder="empleado@sakura.com"
						class="form-input">
				</div>

				<div class="form-group">
					<label>Contraseña</label>
					<input
						type="password"
						formControlName="password"
						placeholder="Mínimo 6 caracteres"
						class="form-input">
				</div>

				<div class="form-group">
					<label>Rol</label>
					<select formControlName="roleId" class="form-select">
						<option value="">Selecciona un rol</option>
						@for (role of roleStats; track role.id) {
							<option [value]="role.id">{{ role.label }}</option>
						}
					</select>
				</div>

				<button
					type="submit"
					class="submit-btn"
					[disabled]="newUserForm.invalid">
					Crear Usuario
				</button>
			</form>
		</div>
	</div>
}
