<div class="dashboard-container" [class.embedded]="embedded">
	@if (!embedded) {
		<app-sidebar
			[menuItems]="sidebarItems"
			[currentUser]="currentUser"
			[cartCount]="cartCount">
		</app-sidebar>
	}

	<div class="dashboard-content" [class.embedded]="embedded">
		@if (!embedded) {
			<div class="dashboard-tabs">
				@for (tab of tabs; track tab.id) {
					<button
						class="tab-button"
						[class.active]="activeTab === tab.id"
						(click)="setActiveTab(tab.id)">
						<span class="tab-icon">{{ tab.icon }}</span>
						<span>{{ tab.label }}</span>
					</button>
				}
			</div>
		}

		@if (activeTab === 'resumen') {
			<!-- Primary summary stats (first row: 4 cards) -->
			<div class="dashboard-stats">
				@for (stat of primaryStats; track stat.title) {
					<app-stat-card
						[title]="stat.title"
						[value]="stat.value"
						[subtitle]="stat.subtitle ?? ''"
						[trendLabel]="stat.trendLabel ?? ''"
						[trendDirection]="stat.trendDirection ?? ''"
						[iconSvg]="stat.iconSvg"
						[variant]="stat.variant">
					</app-stat-card>
				}
			</div>

			<!-- Secondary summary stats (second row: 3 prominent cards) -->
			<div class="dashboard-stats dashboard-stats-secondary">
				@for (stat of secondaryStats; track stat.title) {
					<app-stat-card
						[title]="stat.title"
						[value]="stat.value"
						[subtitle]="stat.subtitle ?? ''"
						[trendLabel]="stat.trendLabel ?? ''"
						[trendDirection]="stat.trendDirection ?? ''"
						[iconSvg]="stat.iconSvg"
						[variant]="stat.variant">
					</app-stat-card>
				}
			</div>

		<div class="dashboard-grid">
			<div class="chart-section">
				<div class="section-header">
					<h2>Ingresos de la Semana</h2>
				</div>
				<div class="chart-container" (mouseleave)="onChartLeave()">
					<svg viewBox="0 0 850 265" preserveAspectRatio="xMidYMid meet" class="chart-svg" (mousemove)="onChartMove($event)">
						<!-- Grid lines -->
						<line x1="50" y1="30" x2="50" y2="230" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
						<line x1="50" y1="230" x2="820" y2="230" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>

						<!-- Horizontal grid -->
						<line x1="50" y1="180" x2="820" y2="180" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
						<line x1="50" y1="130" x2="820" y2="130" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
						<line x1="50" y1="80" x2="820" y2="80" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>

						<!-- Y-axis labels -->
						<text x="35" y="235" font-size="12" fill="#6b7280" text-anchor="end">$0k</text>
						<text x="35" y="185" font-size="12" fill="#6b7280" text-anchor="end">$15k</text>
						<text x="35" y="135" font-size="12" fill="#6b7280" text-anchor="end">$30k</text>
						<text x="35" y="85" font-size="12" fill="#6b7280" text-anchor="end">$45k</text>
						<text x="35" y="35" font-size="12" fill="#6b7280" text-anchor="end">$60k</text>

						<!-- Area -->
						<defs>
							<linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color:#dc2626;stop-opacity:0.3" />
								<stop offset="100%" style="stop-color:#dc2626;stop-opacity:0" />
							</linearGradient>
						</defs>
						<path d="M 80 185 C 140 175, 200 165, 320 155 C 440 145, 560 140, 680 135 C 750 130, 775 122, 800 115 L 800 230 L 80 230 Z" fill="url(#areaGradient)"/>
						<path d="M 80 185 C 140 175, 200 165, 320 155 C 440 145, 560 140, 680 135 C 750 130, 775 122, 800 115" stroke="#dc2626" stroke-width="2.5" fill="none"/>

						<!-- Interactive points -->
						<circle cx="80" cy="185" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Lun', 18000)" (mousemove)="onChartHover($event, 'Lun', 18000)" style="cursor: pointer;"/>
						<circle cx="200" cy="165" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Mar', 25000)" (mousemove)="onChartHover($event, 'Mar', 25000)" style="cursor: pointer;"/>
						<circle cx="320" cy="155" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Mié', 32000)" (mousemove)="onChartHover($event, 'Mié', 32000)" style="cursor: pointer;"/>
						<circle cx="440" cy="145" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Jue', 38000)" (mousemove)="onChartHover($event, 'Jue', 38000)" style="cursor: pointer;"/>
						<circle cx="560" cy="130" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Vie', 52000)" (mousemove)="onChartHover($event, 'Vie', 52000)" style="cursor: pointer;"/>
						<circle cx="680" cy="95" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Sáb', 45000)" (mousemove)="onChartHover($event, 'Sáb', 45000)" style="cursor: pointer;"/>
						<circle cx="800" cy="115" r="6" fill="#dc2626" stroke="#fff" stroke-width="2" class="chart-point" (mouseenter)="onChartHover($event, 'Dom', 41000)" (mousemove)="onChartHover($event, 'Dom', 41000)" style="cursor: pointer;"/>

						<!-- X-axis labels -->
						<text x="80" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Lun</text>
						<text x="200" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Mar</text>
						<text x="320" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Mié</text>
						<text x="440" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Jue</text>
						<text x="560" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Vie</text>
						<text x="680" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Sáb</text>
						<text x="800" y="250" font-size="12" fill="#6b7280" text-anchor="middle">Dom</text>
					</svg>
					@if (tooltipVisible) {
						<div class="chart-tooltip" [style.left.px]="tooltipX" [style.top.px]="tooltipY">
							<div class="tooltip-day">{{ tooltipDay }}</div>
							<div class="tooltip-value">{{ tooltipValue }}</div>
						</div>
					}
				</div>
			</div>

			<div class="top-products-section">
				<div class="section-header">
					<h2>Más Vendidos Hoy</h2>
				</div>
				<div class="products-list">
					@for (product of topProducts; track product.id) {
						<div class="product-row" [class]="'rank-' + product.rank">
							<div class="product-rank">{{ product.rank }}</div>
							<div class="product-name">{{ product.name }}</div>
							<div class="product-bar">
								<div class="bar-fill" [style.width.%]="(product.quantity / topProducts[0].quantity) * 100"></div>
							</div>
							<div class="product-quantity">{{ product.quantity }}</div>
						</div>
					}
				</div>
			</div>
		</div>
		}

		@if (activeTab === 'movimientos') {
			<div class="tab-content">
				<p class="coming-soon">Contenido de Movimientos próximamente...</p>
			</div>
		}

		@if (activeTab === 'usuarios') {
			<div class="tab-content">
				<p class="coming-soon">Contenido de Usuarios próximamente...</p>
			</div>
		}

		@if (activeTab === 'resumen') {
		<div class="recent-orders-section">
			<div class="section-header">
				<h2>Órdenes Recientes</h2>
			</div>
			<div class="orders-table">
				@for (order of recentOrders; track order.id) {
					<div class="order-row" [class]="'status-' + order.status">
						<div class="order-table-num">
							<span>{{ order.tableNumber }}</span>
						</div>
						<div class="order-info">
							<div class="order-items">{{ order.itemsCount }} items</div>
							<div class="order-customer">{{ order.customerName }}</div>
						</div>
						<div class="order-total">{{ order.total | currency }}</div>
						<div class="order-status" [class]="'badge-' + order.status">
							{{ order.statusLabel }}
						</div>
					</div>
				}
			</div>
		</div>
		}
	</div>
</div>
